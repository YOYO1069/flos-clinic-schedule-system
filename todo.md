# FLOS 排班系統 + 考勤管理整合開發

## 專案目標
在現有排班系統中整合考勤管理功能,使用 Supabase 資料庫,部署到 Netlify

## 階段一:分析排班系統架構與設計資料庫
- [x] 分析現有排班系統程式碼結構
- [x] 查看現有 Supabase 資料表
- [x] 設計考勤相關資料表結構
- [x] 規劃功能模組架構

## 階段二:建立考勤系統資料表
- [x] 建立 attendance_records (打卡記錄表)
- [x] 建立 leave_requests (請假申請表)
- [x] 建立 overtime_requests (加班申請表)
- [x] 建立 salary_records (薪資記錄表)
- [x] 設定資料表關聯與索引
- [x] 配置 Row Level Security (RLS)

## 階段三:開發考勤管理功能模組
- [x] 開發打卡功能
  - [x] GPS 定位打卡
  - [x] 上下班打卡記錄
  - [x] 打卡歷史查詢
- [x] 開發出勤記錄管理
  - [x] 出勤記錄列表
  - [x] 異常出勤標記
  - [x] 出勤統計報表
- [x] 開發請假管理
  - [x] 請假申請表單
  - [x] 請假記錄查詢
  - [x] 主管審核介面
- [ ] 開發加班管理
  - [ ] 加班申請
  - [ ] 加班記錄
  - [ ] 加班費計算
- [ ] 開發薪資計算
  - [ ] 自動計算薪資
  - [ ] 薪資明細查詢
  - [ ] 薪資報表匯出
- [ ] 開發數據報表
  - [ ] 出勤統計圖表
  - [ ] 員工考勤分析

## 階段四:測試與部署
- [ ] 功能測試
- [ ] 資料庫讀寫測試
- [ ] 與排班系統整合測試
- [ ] 部署到 Netlify
- [ ] 驗證線上功能

## 階段五:交付
- [ ] 提供部署網址
- [ ] 提供整合說明文件
- [ ] 確認所有功能正常運作


## 階段六:員工登入與分級權限系統
- [x] 建立使用者資料表(users)
- [x] 設定四個職等:管理者、高階主管、一般主管、員工
- [x] 初始化 17 位員工資料和預設密碼
- [x] 實作登入頁面
- [x] 實作登入驗證和 Session 管理
- [x] 實作權限控制中介層
- [x] 根據職等顯示不同功能
- [x] 管理者主控台(查看所有人密碼)
- [x] 員工之間不顯示職等資訊
- [ ] 測試所有職等的登入和權限
- [ ] 部署更新到 Netlify

## 階段七:主管審核請假介面
- [x] 設計審核請假頁面
- [x] 實作權限過濾(高階主管看所有,一般主管看員工)
- [x] 顯示請假申請列表
- [x] 實作審核通過/拒絕功能
- [x] 顯示審核歷史記錄
- [ ] 測試不同職等的審核權限
- [x] 修正 Netlify 部署配置(改用 pnpm)
- [ ] 確認 Netlify 成功部署(等待中)


## 階段八:整合 LINE Bot 打卡系統
- [x] 分析 LINE Bot 打卡系統資料庫結構
- [x] 在 Supabase 建立打卡記錄資料表
- [x] 實作網頁打卡功能(上班/下班)
- [x] 整合 LINE Bot 打卡記錄到網頁顯示
- [x] 確保兩種打卡方式統一儲存
- [ ] 測試雙軌打卡功能
- [x] 修正 Netlify 建置腳本問題
- [x] 確認 client/dist 目錄正確生成
- [x] 修正登入驗證失敗問題
- [x] 檢查 Supabase 環境變數配置
- [x] 確認資料庫連線正常
- [ ] 調整員工名單使用排班系統的人員管理名單
- [ ] 保持現有職等分級不變

## 階段九:修復醫師排班匯出圖片功能
- [x] 解決 html2canvas 不支援 OKLCH 顏色格式問題
- [x] 改用 dom-to-image-more 替代方案
- [x] 測試圖片匯出功能
- [x] 部署修復到 Netlify

## 階段十:員工休假月曆 - 編輯員工功能
- [ ] 刪除測試員工「米米」 (用戶可在網站上直接刪除)
- [x] 實作編輯員工對話框
- [x] 實作編輯員工姓名功能
- [x] 實作調整員工順序功能
- [x] 測試編輯功能
- [x] 部署到 Netlify

## 階段十一:員工休假月曆進階功能
- [x] 設計並建立操作記錄資料表 (operation_logs)
- [x] 實作員工排序功能 (上下調整順序)
- [x] 實作普通員工權限控制 (只能點自己的排班)
- [x] 實作操作記錄功能 (記錄誰操作了什麼)
- [x] 新增 ON 符號選項
- [x] 新增「特」(特休)符號選項
- [ ] 管理員可查看操作記錄 (待實作查詢介面)
- [x] 測試所有功能
- [x] 部署到 Netlify
- [x] 新增員工職位欄位和資料
- [x] 職位顯示在管理員工對話框中

## 階段十二:員工打卡定位功能
- [x] 檢查網站所有現有功能
- [x] 設計打卡定位資料表結構
- [x] 實作打卡頁面和定位功能
- [x] 記錄打卡時間和GPS座標
- [x] 在打卡記錄中顯示GPS座標
- [x] 測試定位功能
- [x] 部署到 Netlify

## 階段十三:有效打卡範圍驗證功能
- [ ] 建立 clinic_locations 資料表(診所位置和有效範圍)
- [ ] 實作 Haversine 距離計算公式
- [ ] 在打卡時驗證是否在有效範圍內
- [ ] 顯示當前距離診所的距離
- [ ] 範圍外打卡標記為「待審核」
- [ ] 實作管理員設定診所位置介面
- [ ] 實作管理員設定有效範圍介面
- [ ] 實作管理員審核範圍外打卡
- [ ] 測試距離計算準確性
- [ ] 部署到 Netlify

## 階段十四:修復 iPhone 打卡問題
- [ ] 診斷 iPhone 無法打卡的原因
- [ ] 檢查 iOS Safari 定位 API 相容性
- [ ] 修復定位權限請求問題
- [ ] 新增更詳細的錯誤提示
- [ ] 測試 iPhone Safari 打卡功能
- [ ] 部署修復
