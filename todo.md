# FLOS 排班系統 + 考勤管理整合開發

## 專案目標
在現有排班系統中整合考勤管理功能,使用 Supabase 資料庫,部署到 Netlify

## 階段一:分析排班系統架構與設計資料庫
- [x] 分析現有排班系統程式碼結構
- [x] 查看現有 Supabase 資料表
- [x] 設計考勤相關資料表結構
- [x] 規劃功能模組架構

## 階段二:建立考勤系統資料表
- [x] 建立 attendance_records (打卡記錄表)
- [x] 建立 leave_requests (請假申請表)
- [x] 建立 overtime_requests (加班申請表)
- [x] 建立 salary_records (薪資記錄表)
- [x] 設定資料表關聯與索引
- [x] 配置 Row Level Security (RLS)

## 階段三:開發考勤管理功能模組
- [x] 開發打卡功能
  - [x] GPS 定位打卡
  - [x] 上下班打卡記錄
  - [x] 打卡歷史查詢
- [x] 開發出勤記錄管理
  - [x] 出勤記錄列表
  - [x] 異常出勤標記
  - [x] 出勤統計報表
- [x] 開發請假管理
  - [x] 請假申請表單
  - [x] 請假記錄查詢
  - [x] 主管審核介面
- [ ] 開發加班管理
  - [ ] 加班申請
  - [ ] 加班記錄
  - [ ] 加班費計算
- [ ] 開發薪資計算
  - [ ] 自動計算薪資
  - [ ] 薪資明細查詢
  - [ ] 薪資報表匯出
- [ ] 開發數據報表
  - [ ] 出勤統計圖表
  - [ ] 員工考勤分析

## 階段四:測試與部署
- [ ] 功能測試
- [ ] 資料庫讀寫測試
- [ ] 與排班系統整合測試
- [ ] 部署到 Netlify
- [ ] 驗證線上功能

## 階段五:交付
- [ ] 提供部署網址
- [ ] 提供整合說明文件
- [ ] 確認所有功能正常運作


## 階段六:員工登入與分級權限系統
- [x] 建立使用者資料表(users)
- [x] 設定四個職等:管理者、高階主管、一般主管、員工
- [x] 初始化 17 位員工資料和預設密碼
- [x] 實作登入頁面
- [x] 實作登入驗證和 Session 管理
- [x] 實作權限控制中介層
- [x] 根據職等顯示不同功能
- [x] 管理者主控台(查看所有人密碼)
- [x] 員工之間不顯示職等資訊
- [ ] 測試所有職等的登入和權限
- [ ] 部署更新到 Netlify

## 階段七:主管審核請假介面
- [x] 設計審核請假頁面
- [x] 實作權限過濾(高階主管看所有,一般主管看員工)
- [x] 顯示請假申請列表
- [x] 實作審核通過/拒絕功能
- [x] 顯示審核歷史記錄
- [ ] 測試不同職等的審核權限
- [x] 修正 Netlify 部署配置(改用 pnpm)
- [ ] 確認 Netlify 成功部署(等待中)


## 階段八:整合 LINE Bot 打卡系統
- [x] 分析 LINE Bot 打卡系統資料庫結構
- [x] 在 Supabase 建立打卡記錄資料表
- [x] 實作網頁打卡功能(上班/下班)
- [x] 整合 LINE Bot 打卡記錄到網頁顯示
- [x] 確保兩種打卡方式統一儲存
- [ ] 測試雙軌打卡功能
- [ ] 修正 Netlify 建置腳本問題
- [ ] 確認 client/dist 目錄正確生成


## 階段九:月曆表格式排班系統重構
- [x] 將排班介面改為月曆表格式(類似 Google Calendar)
- [x] 每個日期格子顯示當日排班員工
- [ ] 支援拖拉方式調整排班
- [x] 月份切換功能(上一月/下一月)
- [x] 顯示當月所有員工的休假狀態
- [x] 在月曆上標示員工請假日期(不同假別不同顏色)
- [x] 點擊日期可查看該日所有請假員工
- [ ] 支援批量審核請假申請
- [x] 支援多種班別設定(早班/中班/晚班/休假)
- [ ] 自動檢查排班衝突
- [ ] 排班範本功能
- [ ] 匯出月度排班表為 PDF/Excel
- [ ] 主管可在月曆上直接審核請假
- [ ] 請假衝突提醒(人力不足警告)
- [ ] 請假歷史記錄查詢
- [x] 新增排班功能(點擊日期新增)
- [x] 刪除排班功能(hover 顯示刪除按鈕)
- [x] 修改資料庫表結構支援排班

## 階段十:登入問題修正
- [x] 診斷 Supabase API Key 問題
- [x] 更新 Netlify 環境變數
- [x] 修正 client/src/lib/supabase.ts 配置
- [x] 直接在程式碼中寫死 Supabase 配置
- [x] 測試登入功能正常運作
- [x] 確認 16 位員工資料完整


## LINE Bot 資訊 (邊美小秘書)
- User ID: Ub0992e5cf905ab756f4113ffda8d2634
- Channel ID: 2008492676
- Bot basic ID: @759wnkso
- Channel secret: ae25135b2ba1d26ff8b1afe952b3c72a
- Channel access token: ti+rzKuJYhtA7sz6Yk00Mw1Wlc3ER4TlBzq1RB97Zy8gwEk3qepKRdzGFDZAREn22tBe9Z8MqvhcRRvoF0hU7eXFbN0AHvRgw8fK6pCzMQxVqOUPaaOhvA1l65sc0SOwVQQzIfb+051AFsvFWvImDwdB04t89/1O/w1cDnyilFU=
- Webhook URL: https://rad-paletas-14483a.netlify.app/.netlify/functions/yuemei-webhook


## 緊急:恢復原有資料和完整功能
- [x] 找回原先的排班記錄並匯入新系統
- [x] 參考之前討論的完整功能規格
- [x] 保留原有優秀的 UI/UX 設計
- [x] 使用嵌入方式整合,不破壞原有功能
- [x] 確保所有已排定的班表資料不遺失
- [x] 恢復醫師排班頁面(原有設計)
- [x] 保留員工排班月曆視圖(新功能)
- [x] 在主控台新增醫師排班入口


## 緊急修正:月曆載入問題
- [x] 修正月曆資料載入失敗問題
- [x] 確保月曆可以正常點擊
- [x] 新增手動補做排班功能
- [x] 測試資料顯示正常
- [x] 新增批量匯入功能(CSV 格式)
- [x] 新增匯出功能
- [x] 顯示請假狀態在月曆上
- [x] 優化 UI 與交互體驗


## 功能完善清單
- [x] 排班衝突檢查(同一員工同一時間不能有多個排班)
- [ ] 拖拉調整排班功能
- [ ] 排班範本功能(快速套用常用排班)
- [x] 月曆上直接審核請假(Ctrl/Cmd + 點擊)
- [ ] 請假衝突提醒(人力不足警告)
- [ ] 匯出 PDF/Excel 格式排班表
- [ ] 加班管理系統
- [ ] 薪資計算系統
- [ ] 出勤統計圖表
- [ ] 員工考勤分析報表
- [ ] 測試所有職等的權限控制
- [ ] LINE Bot 打卡整合測試


## 班別系統調整
- [x] 移除早班/中班/晚班固定時間
- [x] 改為簡單的「上班」/「休假」標記
- [x] 實際工作時間由打卡記錄決定
- [x] 保留彈性加班機制
- [x] 更新月曆顯示邏輯
- [x] 更新批量匯入說明
- [x] 簡化衝突檢查邏輯
