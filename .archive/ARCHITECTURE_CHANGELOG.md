# FLOS æ’ç­ç³»çµ± - æ¶æ§‹è®Šæ›´æ—¥èªŒ

## ğŸ“… 2025-12-08 - æ¶æ§‹ç°¡åŒ–ï¼šå¾ tRPC å¾Œç«¯é·ç§»åˆ°ç´” Supabase å‰ç«¯

### ğŸ¯ è®Šæ›´åŸå› 

**å•é¡Œï¼š** ç³»çµ±éƒ¨ç½²åœ¨ Netlifyï¼ˆåƒ…æ”¯æ´éœæ…‹ç¶²ç«™ï¼‰ï¼Œä½†ä½¿ç”¨ tRPC æ¶æ§‹éœ€è¦ Node.js å¾Œç«¯ä¼ºæœå™¨ï¼Œå°è‡´ä»¥ä¸‹åŠŸèƒ½ç„¡æ³•é‹ä½œï¼š
- âŒ è«‹å‡ç”³è«‹èˆ‡å¯©æ ¸
- âŒ ä¿®æ”¹å¯†ç¢¼
- âŒ æ‰“å¡è¨˜éŒ„
- âŒ æ‰€æœ‰éœ€è¦ API çš„åŠŸèƒ½

**åŸå§‹æ¶æ§‹ï¼š**
```
å‰ç«¯ (React) â†’ tRPC Client â†’ [éœ€è¦å¾Œç«¯ä¼ºæœå™¨] â†’ tRPC Server â†’ Supabase
                                    â†‘
                              ç„¡æ³•éƒ¨ç½²åœ¨ Netlify
```

**æ–°æ¶æ§‹ï¼š**
```
å‰ç«¯ (React) â†’ Supabase Client â†’ Supabase è³‡æ–™åº«
         â†‘
    ç›´æ¥é€£ç·šï¼Œç„¡éœ€å¾Œç«¯
```

---

## ğŸ”„ ä¸»è¦è®Šæ›´

### 1. å¯†ç¢¼é›œæ¹Šæ©Ÿåˆ¶æ›´æ›

**åŸå¯¦ä½œï¼ˆtRPC å¾Œç«¯ï¼‰ï¼š**
- ä½¿ç”¨ `bcryptjs` å¥—ä»¶
- åœ¨ Node.js ä¼ºæœå™¨ç«¯åŸ·è¡Œ
- å®‰å…¨æ€§é«˜ï¼Œä½†éœ€è¦å¾Œç«¯

**æ–°å¯¦ä½œï¼ˆç´”å‰ç«¯ï¼‰ï¼š**
- ä½¿ç”¨ Web Crypto API (SHA-256)
- åœ¨ç€è¦½å™¨ç«¯åŸ·è¡Œ
- ç„¡éœ€å¾Œç«¯ï¼Œä½†å®‰å…¨æ€§ç¨ä½

**æª”æ¡ˆè®Šæ›´ï¼š**
- âœ… æ–°å¢ï¼š`client/src/lib/crypto.ts` - ç€è¦½å™¨ç›¸å®¹çš„å¯†ç¢¼é›œæ¹Šå·¥å…·
- ğŸ”„ ä¿®æ”¹ï¼š`client/src/pages/Login.tsx` - ä½¿ç”¨ `verifyPassword()` æ›¿ä»£ bcrypt
- ğŸ”„ ä¿®æ”¹ï¼š`client/src/pages/Home.tsx` - ä½¿ç”¨ `hashPassword()` å’Œ `verifyPassword()`

**è³‡æ–™åº«è®Šæ›´ï¼š**
- æ‰€æœ‰å“¡å·¥å¯†ç¢¼å·²å¾ bcrypt æ ¼å¼è½‰æ›ç‚º SHA-256 æ ¼å¼
- ä½¿ç”¨è…³æœ¬ï¼š`/tmp/update_passwords.py`

---

### 2. è«‹å‡ç®¡ç†ç³»çµ±æ•´åˆç™»å…¥ç‹€æ…‹

**åŸå¯¦ä½œï¼š**
```typescript
// ç¡¬ç·¨ç¢¼å“¡å·¥ ID
const employeeId = 1;
```

**æ–°å¯¦ä½œï¼š**
```typescript
// å¾ localStorage è®€å–ç™»å…¥ä½¿ç”¨è€…
const [currentUser, setCurrentUser] = useState<any>(null);
const [employeeId, setEmployeeId] = useState<number | null>(null);

useEffect(() => {
  const userStr = localStorage.getItem('user');
  if (userStr) {
    const user = JSON.parse(userStr);
    setCurrentUser(user);
    setEmployeeId(user.id);
  }
}, []);
```

**æª”æ¡ˆè®Šæ›´ï¼š**
- ğŸ”„ ä¿®æ”¹ï¼š`client/src/pages/LeaveManagement.tsx` - è®€å–ç•¶å‰ç™»å…¥ä½¿ç”¨è€…
- âœ… æ–°å¢ï¼šåœ¨é é¢æ¨™é¡Œé¡¯ç¤ºç•¶å‰ä½¿ç”¨è€…è³‡è¨Š

---

## ğŸ“¦ å‚™ä»½ç­–ç•¥

### ä¿ç•™çš„åŸå§‹å¯¦ä½œ

æ‰€æœ‰åŸå§‹ç¨‹å¼ç¢¼å·²å‚™ä»½è‡³ `.archive/implementations/` ç›®éŒ„ï¼š

```
.archive/
â”œâ”€â”€ implementations/
â”‚   â”œâ”€â”€ trpc-backend/          # åŸå§‹ tRPC å¾Œç«¯æ¶æ§‹
â”‚   â”‚   â”œâ”€â”€ server/            # Node.js ä¼ºæœå™¨ç¨‹å¼ç¢¼
â”‚   â”‚   â”œâ”€â”€ Login.tsx.backup   # ä½¿ç”¨ tRPC çš„ç™»å…¥é é¢
â”‚   â”‚   â””â”€â”€ Home.tsx.backup    # ä½¿ç”¨ bcrypt çš„é¦–é 
â”‚   â””â”€â”€ supabase-direct/       # æ–°çš„ç´” Supabase æ¶æ§‹
â”‚       â”œâ”€â”€ crypto.ts          # ç€è¦½å™¨ç›¸å®¹çš„å¯†ç¢¼å·¥å…·
â”‚       â”œâ”€â”€ Login.tsx          # ç›´æ¥ä½¿ç”¨ Supabase çš„ç™»å…¥
â”‚       â””â”€â”€ Home.tsx           # ä½¿ç”¨ SHA-256 çš„é¦–é 
â””â”€â”€ migration-logs/
    â””â”€â”€ password_migration.log # å¯†ç¢¼è½‰æ›æ—¥èªŒ
```

---

## ğŸ”€ å…©ç¨®æ¶æ§‹å°æ¯”

| ç‰¹æ€§ | tRPC å¾Œç«¯æ¶æ§‹ | ç´” Supabase æ¶æ§‹ |
|------|--------------|-----------------|
| **éƒ¨ç½²è¤‡é›œåº¦** | éœ€è¦ Node.js ä¼ºæœå™¨ï¼ˆRailway/Renderï¼‰ | åƒ…éœ€éœæ…‹ç¶²ç«™è¨—ç®¡ï¼ˆNetlifyï¼‰ |
| **æˆæœ¬** | $5-10/æœˆ | $0ï¼ˆNetlify å…è²»ï¼‰ |
| **å¯†ç¢¼å®‰å…¨æ€§** | é«˜ï¼ˆbcryptï¼‰ | ä¸­ï¼ˆSHA-256ï¼‰ |
| **é–‹ç™¼è¤‡é›œåº¦** | é«˜ï¼ˆå‰å¾Œç«¯åˆ†é›¢ï¼‰ | ä½ï¼ˆç´”å‰ç«¯ï¼‰ |
| **ç¶­è­·é›£åº¦** | é«˜ | ä½ |
| **é©ç”¨å ´æ™¯** | å¤§å‹æ‡‰ç”¨ã€é«˜å®‰å…¨éœ€æ±‚ | ä¸­å°å‹å…§éƒ¨ç³»çµ± |

---

## ğŸš€ éƒ¨ç½²æ–¹å¼

### é¸é … Aï¼šç´” Supabase æ¶æ§‹ï¼ˆç•¶å‰ï¼‰

**å„ªé»ï¼š**
- âœ… é›¶æˆæœ¬éƒ¨ç½²
- âœ… è‡ªå‹•éƒ¨ç½²ï¼ˆæ¨é€åˆ° GitHub å³å¯ï¼‰
- âœ… ç¶­è­·ç°¡å–®

**ç¼ºé»ï¼š**
- âš ï¸ å¯†ç¢¼å®‰å…¨æ€§è¼ƒä½ï¼ˆSHA-256 å¯è¢«æš´åŠ›ç ´è§£ï¼‰
- âš ï¸ æ‰€æœ‰é‚è¼¯åœ¨å‰ç«¯ï¼ˆå¯è¢«æª¢è¦–ï¼‰

**éƒ¨ç½²æ­¥é©Ÿï¼š**
1. æ¨é€ç¨‹å¼ç¢¼åˆ° GitHub `main` åˆ†æ”¯
2. Netlify è‡ªå‹•å»ºç½®ä¸¦éƒ¨ç½²
3. å®Œæˆï¼

---

### é¸é … Bï¼štRPC å¾Œç«¯æ¶æ§‹ï¼ˆéœ€é¡å¤–éƒ¨ç½²ï¼‰

**å„ªé»ï¼š**
- âœ… å¯†ç¢¼å®‰å…¨æ€§é«˜ï¼ˆbcryptï¼‰
- âœ… æ¥­å‹™é‚è¼¯åœ¨å¾Œç«¯ï¼ˆæ›´å®‰å…¨ï¼‰
- âœ… å¯æ“´å±•æ€§å¼·

**ç¼ºé»ï¼š**
- âŒ éœ€è¦é¡å¤–éƒ¨ç½²å¾Œç«¯ä¼ºæœå™¨
- âŒ æ¯æœˆæˆæœ¬ $5-10
- âŒ ç¶­è­·è¤‡é›œåº¦é«˜

**éƒ¨ç½²æ­¥é©Ÿï¼š**
1. éƒ¨ç½²å¾Œç«¯åˆ° Railwayï¼ˆåƒè€ƒ `/tmp/RAILWAY_DEPLOYMENT_GUIDE.md`ï¼‰
2. æ›´æ–°å‰ç«¯ API ç«¯é»
3. æ¨é€ç¨‹å¼ç¢¼åˆ° GitHub
4. Netlify éƒ¨ç½²å‰ç«¯

---

## ğŸ“ é·ç§»æª¢æŸ¥æ¸…å–®

- [x] å»ºç«‹å‚™ä»½ç›®éŒ„çµæ§‹
- [x] å¯¦ä½œç€è¦½å™¨ç›¸å®¹çš„å¯†ç¢¼é›œæ¹Šï¼ˆSHA-256ï¼‰
- [x] æ›´æ–°æ‰€æœ‰å“¡å·¥å¯†ç¢¼æ ¼å¼
- [x] ä¿®æ”¹ç™»å…¥é é¢ä½¿ç”¨æ–°çš„å¯†ç¢¼é©—è­‰
- [x] ä¿®æ”¹ä¿®æ”¹å¯†ç¢¼åŠŸèƒ½ä½¿ç”¨æ–°çš„é›œæ¹Šæ–¹å¼
- [x] æ•´åˆè«‹å‡ç®¡ç†èˆ‡ç™»å…¥ç‹€æ…‹
- [x] æ¨é€ç¨‹å¼ç¢¼åˆ° GitHub
- [ ] æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
- [ ] å»ºç«‹å®Œæ•´æ–‡ä»¶

---

## ğŸ” å®‰å…¨æ€§å»ºè­°

### ç•¶å‰æ¶æ§‹ï¼ˆSHA-256ï¼‰çš„å®‰å…¨æ€§æ”¹é€²ï¼š

1. **åŠ é¹½ï¼ˆSaltï¼‰ï¼š** åœ¨å¯†ç¢¼é›œæ¹Šå‰åŠ å…¥éš¨æ©Ÿé¹½å€¼
   ```typescript
   const salt = crypto.randomUUID();
   const hash = await hashPassword(password + salt);
   // å„²å­˜ salt å’Œ hash
   ```

2. **å¤šæ¬¡é›œæ¹Šï¼š** ä½¿ç”¨ PBKDF2 æ›¿ä»£å–®æ¬¡ SHA-256
   ```typescript
   const hash = await crypto.subtle.deriveBits(
     { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
     key, 256
   );
   ```

3. **å•Ÿç”¨ HTTPSï¼š** Netlify è‡ªå‹•æä¾›ï¼Œç¢ºä¿å‚³è¼¸åŠ å¯†

4. **Row Level Securityï¼ˆRLSï¼‰ï¼š** åœ¨ Supabase å•Ÿç”¨è³‡æ–™è¡¨ç´šåˆ¥æ¬Šé™æ§åˆ¶

---

## ğŸ“ å­¸ç¿’è³‡æº

- [Supabase å®˜æ–¹æ–‡ä»¶](https://supabase.com/docs)
- [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API)
- [OWASP å¯†ç¢¼å„²å­˜æŒ‡å—](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)

---

## ğŸ“ å›æ»¾æ–¹æ¡ˆ

å¦‚æœéœ€è¦å›åˆ° tRPC å¾Œç«¯æ¶æ§‹ï¼š

1. å¾ `.archive/implementations/trpc-backend/` æ¢å¾©åŸå§‹æª”æ¡ˆ
2. éƒ¨ç½²å¾Œç«¯åˆ° Railway
3. æ›´æ–°å‰ç«¯ API ç«¯é»
4. å°‡è³‡æ–™åº«å¯†ç¢¼è½‰æ›å› bcrypt æ ¼å¼

---

**è®Šæ›´æ—¥æœŸï¼š** 2025-12-08  
**è®Šæ›´è€…ï¼š** Manus AI Assistant  
**å¯©æ ¸ç‹€æ…‹ï¼š** å¾…æ¸¬è©¦  
**å½±éŸ¿ç¯„åœï¼š** ç™»å…¥ç³»çµ±ã€å¯†ç¢¼ç®¡ç†ã€è«‹å‡ç®¡ç†
